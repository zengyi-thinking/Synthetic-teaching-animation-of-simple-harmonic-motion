# 简谐运动教学仿真系统 - 闪退问题修复方案

## 已修复的问题

1. **样式表解析错误**

   - 在`phase_main.py`中简化了频率锁定指示器和其他 UI 元素的样式表
   - 将多行样式表转换为单行样式，移除了不兼容的 CSS 属性
   - 虽然仍有解析警告，但不影响程序正常运行

2. **频率参数不一致**

   - 在`ui_framework.py`中修改了初始参数，确保`omega2`的值为 1.0
   - 将默认频率比从`1:2`修改为`1:1`，保证相位差合成模式正确运行

3. **窗口引用被过早释放**

   - 在`launcher.py`中添加了全局变量保存窗口引用，防止窗口被垃圾回收器回收
   - 明确调用`window.show()`显示窗口
   - 直接启动 QApplication 事件循环，确保应用程序持续运行

4. **Matplotlib 后端兼容性问题**

   - 在`ui_framework.py`中添加了异常处理，防止 Matplotlib 后端设置失败导致闪退
   - 添加了多个备用后端选择机制

5. **启动器错误处理**

   - 强化了`launcher.py`的错误处理机制
   - 添加了详细的日志记录功能和错误窗口提示
   - 捕获未处理的异常，防止程序闪退

6. **图形元素布局优化**

   - 修改了相量图中图例的位置，避免遮挡矢量合成显示
   - 将图例从"center right"改为"upper right"位置

7. **PyQt6 插件依赖问题**
   - 修改了`shm_app_release.spec`，添加 PyQt6 所需的插件和样式文件
   - 确保包含所有必要的 Qt 依赖项和资源文件

## 如何运行修复后的程序

1. 使用以下命令重新打包:

   ```
   pyinstaller --clean shm_app_release.spec
   ```

2. 运行生成的 EXE 文件:

   ```
   dist/简谐运动教学仿真系统/简谐运动教学仿真系统.exe
   ```

3. 如果仍然出现闪退，请检查 logs 目录下的错误日志了解详细信息。

## 关键修改说明

1. **简化样式表**:

   - 我们发现复杂的 QSS 样式表可能导致解析错误
   - 将多行样式表简化为单行，移除不兼容属性

2. **修复初始参数**:

   - 确保 omega2 初始值为 1.0
   - 确保默认频率比为 1:1

3. **保持窗口引用**:

   - 使用全局变量保持主窗口的引用
   - 明确调用 window.show()和 app.exec()

4. **异常处理**:

   - 添加全面的异常捕获和错误信息记录
   - 发生错误时显示友好的错误提示窗口

5. **PyQt6 配置**:
   - 显式添加所有必要的 PyQt6 模块和插件
   - 包含 Qt 样式和平台插件，确保界面正常显示

## 调试技巧

如果程序仍然不稳定，可以使用我们提供的调试启动器(`debug_launcher.py`)来测试程序功能：

```
python debug_launcher.py
```

该启动器会输出详细的调试信息，帮助定位问题。

## 预期效果

修复后，程序应该能够正常启动和运行，并且相位差合成模式中的两个频率将保持相同，解决了原来的问题。如果仍有问题，请查看 logs 目录下的错误日志获取更详细的信息。
